---
title: é¢å¯¹èººå¹³åŒäº‹ï¼Œæˆ‘å¼€å‘äº†ä¸€ä¸ªæ’ä»¶æ²»å¥½äº†æˆ‘çš„ç²¾ç¥å†…è€—âš¡âš¡âš¡
isTimeLine: true
date: 2023-07-10
category:
  - å‰ç«¯
tag:
  - JavaScript
  - Vite
---
> æ–‡ç« åŒæ­¥åœ¨å…¬ä¼—å·ï¼šèŒèŒå“’è‰å¤´å°†å†›ï¼Œæ¬¢è¿å…³æ³¨

æ’ä»¶å·²ç»å¼€æºäº†ï¼Œå¯ä»¥çœ‹æ–‡ç« æœ«å°¾

## consoleç‹‚é­”èƒ½æœ‰å¤šç‹‚

äº‹æƒ…æ˜¯è¿™æ ·çš„ï¼Œå‰æ®µæ—¶é—´æˆ‘åŠ å…¥äº†å…¬å¸æŸä¸ªå°é¡¹ç›®ç»„

å…¥ç»„ç¬¬ä¸€å¤©ï¼Œæˆ‘è¦æ¥äº†é¡¹ç›®æƒé™ï¼Œä¸‹è½½å®Œä»£ç å’Œä¾èµ–

ç„¶å`npm start`ï¼Œæ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼Œ

æˆ‘å°¼ç›ï¼Œä¸€ä¸ªç™»é™†é¡µé¢å°±è¿™ä¹ˆå¤š`log`ï¼Ÿ

æ­¤åˆ»æˆ‘æ€€ç€å¿å¿‘çš„å¿ƒæƒ…æ‰“å¼€äº†è‡ªå·±çš„å³å°†è´Ÿè´£çš„æ¨¡å—å…¥å£é¡µé¢ï¼š

è¿™è®©æˆ‘æ€ä¹ˆè°ƒè¯•å•Šï¼Ÿ

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ca10e95c0b464e03a220cb104776bc5e~tplv-k3u1fbpfcp-watermark.image?)

ä¸Šå›¾æˆ‘å·²ç»æŠŠæ•æ„Ÿä¿¡æ¯å±è”½æ‰äº†(^/Ï‰ï¼¼^)ï¼Œæ¯ç‚¹å‡»ä¸‹é¡µé¢å°±ä¼šè¹¦å‡ºå¥½å‡ è¡Œ`console`

å…¨å±€ä¸€æœç´¢ï¼Œå±…ç„¶æœ‰è¿‘800å¤šæ¡`console`è¯­å¥ã€‚

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/af9ce0143ce5419494e0e0701a5f173f~tplv-k3u1fbpfcp-watermark.image?)

èµ·åˆï¼Œæˆ‘ä¸ºäº†æ–¹ä¾¿æˆ‘è°ƒè¯•ï¼Œæˆ‘æŠŠå½±å“æˆ‘è°ƒè¯•çš„`console`ä¸€ä¸€æ³¨é‡Šäº†ï¼ŒçœŸæ˜¯ä¸ªä½“åŠ›æ´»ã€‚

å°±åœ¨æˆ‘å¼€å¿ƒäº†å‡ å¤©åï¼ŒåŒäº‹åœ¨å¼€å‘ç¾¤é‡Œå‘é—®äº†ï¼Œâ€œæˆ‘è°ƒè¯•æ‰“å°çš„`console`æ€ä¹ˆä¸è§äº†ï¼Ÿâ€ï¼Œ

æˆ‘è¯´æˆ‘æ³¨é‡Šäº†ï¼Œé‚£ä¹ˆå¤š`console`æˆ‘æ²¡æ³•è°ƒè¯•å•Šï¼Œç„¶åå°±è¢«å¥½å‡ ä¸ªåŒäº‹â€å›´æ”»â€œäº†ï¼Œ

åæ¥æƒ³æƒ³æ²¡ç»è¿‡äººå®¶çš„åŒæ„ä¿®æ”¹äººå®¶çš„ä»£ç ç¡®å®ä¸å¯¹ï¼

å…¶å®ä»ä»–ä»¬çš„ä»£ç æ¥çœ‹ï¼Œå®Œå…¨æ˜¯èººå¹³çš„çŠ¶æ€ï¼Œå®Œå…¨æ”¾å¼ƒäº†å…¬å¸çš„ä»£ç è§„èŒƒï¼ŒçœŸçš„å¾ˆè®©äººemoã€‚

## emoæ—¶é—´çš„æ€è€ƒ

æ—¢ç„¶äººå®¶å–œæ¬¢é‚£æ ·åšï¼Œæˆ‘ä¹Ÿæ²¡åŠæ³•ï¼Œemoäº†ä¸€ä¼šï¼Œæˆ‘å°±å¯»æ‰¾åˆ«çš„æ–¹æ³•è§£å†³è®©æˆ‘å¼ºè¿«ç—‡å‘ä½œçš„æ–¹æ³•ã€‚

ç¬¬ä¸€ç§æ–¹æ³•æ˜¯å¦‚æœæœ‰consoleå°±ä¸è®©æäº¤ä»£ç ï¼Œæ˜¾ç„¶ä¸ç°å®ï¼Œ

ç¬¬äºŒç§æ–¹æ³•æ˜¯ä½¿ç”¨å»é™¤conosleçš„æ’ä»¶ï¼Œä½†æ˜¯æœ‰ä¸ªç¼ºç‚¹ï¼Œæˆ‘çš„consoleä¹Ÿä¼šè¢«å»æ‰ï¼Œ

ç„¦è™‘äº†å¥½ä¹…ï¼Œæˆ‘å°±æƒ³åˆ°ï¼Œæœ‰æ²¡æœ‰ä¸€ç§æ’ä»¶ï¼Œåœ¨å¼€å‘ç¯å¢ƒåªå±•ç¤ºå¼€å‘è€…è‡ªå·±çš„consoleï¼Œä½†æ˜¯ä¸å½±å“åˆ«äººå¼€å‘æ—¶è°ƒè¯•ã€‚

æ‰¾äº†å¥½ä¹…éƒ½æ²¡æ‰¾åˆ°ï¼Œé‚£å°±è‡ªå·±åŠ¨æ‰‹å¼€å‘ä¸€ä¸ªå§ã€‚

æˆ‘çš„æ€è·¯æ˜¯

- åœ¨æ¯ä¸ªæ–‡ä»¶ä¸­åŒ¹é…consoleè¯­å¥
- ç”¨åŒ¹é…åˆ°çš„è¡Œï¼Œè¯·æ±‚gitï¼ŒæŸ¥çœ‹å½“å‰è¡Œçš„ä½œè€…
- å¦‚æœä¸æ˜¯æˆ‘å°±ç»Ÿç»Ÿåˆ é™¤consoleä¹‹åå†build

è¿™æ ·æ—¢ä¸ä¼šå¹²æ‰°æˆ‘å¼€å‘ï¼Œä¹Ÿä¸ä¼šå½±å“åˆ«äººå¼€å‘è°ƒè¯•äº†ã€‚

[ä¸Šæ¬¡çš„æ–‡ç« ](https://juejin.cn/spost/7244520633354141751)å·²ç»ä»‹ç»äº†viteçš„æ’ä»¶å¼€å‘äº†ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°äº†ã€‚

æˆ‘ä»¬å¼€å‘çš„æ’ä»¶ä¸»è¦æ˜¯åœ¨æ–‡ä»¶ç¼–è¯‘æ—¶ï¼Œå°†æ–‡ä»¶ä¸­çš„consoleæ™ºèƒ½çš„æ¸…é™¤ï¼Œå¯¹åº”çš„æ’ä»¶hookä¸ºtransformã€‚åŸºæœ¬çš„ç»“æ„å¦‚ä¸‹ã€‚

```js
const RemoveConsole = (): {
  name: string;
  enforce: 'pre';
  transform: (code: string, id: string) => any;
} => {

  return {
    name: 'remove-console',
    enforce: "pre",
    transform: (code, id) => {
      // todo something
      return code
    }
  }
}
```
æ¥ä¸‹æ¥ä¸€æ­¥æ­¥å®ç°ï¼Œ

### åŒ¹é…consoleè¯­å¥
å¦‚æœæ–‡ä»¶ä¸­å­˜åœ¨consoleåˆ™è¿›è¡Œåˆ†æï¼Œå¦åˆ™è¿”å›åŸä»£ç ã€‚

åˆ†æè¿‡ç¨‹ï¼š
1. æŒ‰è¡Œåˆ’åˆ†
2. åˆ†æå‡ºåŒ…å«consoleçš„è¡Œ

### æŸ¥è¯¢gitä½œè€…

ä¸»è¦ä½¿ç”¨child_processå­è¿›ç¨‹è¿è¡Œgitå‘½ä»¤ï¼Œæ ¹æ®å‘½ä»¤çš„è¿”å›ç»“æœåˆ†åˆ«å¤„ç†ï¼Œ

ä¾‹å¦‚æˆ‘ä»¬æˆ–è€…å½“å‰ä½œè€…ï¼š
```js
const userName = childProcess.execSync(
  `git config user.name`,
  { encoding: 'utf-8' }
)
console.log(userName)
// mmdctjj
```
åˆ†ææ¯è¡Œä½œè€…ï¼Œä½¿ç”¨çš„gitå‘½ä»¤æ˜¯
```js
// æŸ¥çœ‹æŒ‡å®šé—®ä»·ä½ çš„l1åˆ°l2è¡Œçš„ä½œè€…è¯¦ç»†ä¿¡æ¯
git blame -L l1,l2 --porcelain filepath
```

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d62ac9f0c22b4dec8da23ba9247c58fb~tplv-k3u1fbpfcp-watermark.image?)

æˆ‘ä»¬è¿˜éœ€è¦åœ¨æ­¤åŸºç¡€ä¸Šæ”¹é€ ä¸‹ï¼Œå®Œæ•´çš„å‘½ä»¤å¦‚ä¸‹ï¼šï¼ˆwinä¸æ”¯æŒgrepï¼Œä½¿ç”¨findsträ»£æ›¿ï¼‰
```js
git blame -L ${line+1},${line+1} --porcelain ${id} | grep "^author "
```
æ¥ç€ä»å­—ç¬¦ä¸²ä¸­æˆªå–å‡ºä½œè€…
```js
const author = authorInfo.slice(authorInfo.indexOf(`author `) + 7)
```
æ ¹æ®å½“å‰ä½œè€…å’Œconosleçš„ä½œè€…æ˜¯å¦ç›¸ç­‰ã€‚æˆ‘ä»¬å¾—å‡ºéœ€è¦åˆ é™¤çš„è¡Œ
```js
// éœ€è¦åˆ é™¤çš„è¡Œ
 const removeLine = includesLines.filter(line => {
    const authorInfo = childProcess.execSync(
      `git blame -L ${line+1},${line+1} --porcelain ${id} | grep "^author "`,
      { encoding: 'utf-8' 
    )
    const author = authorInfo
      .slice(authorInfo.indexOf(`author `) + 7)
      .split('\n')[0]
      
    return author !== userName
})
```
### åˆ é™¤console
æ¥ç€æˆ‘ä»¬éå†æ¯ä¸€è¡Œï¼Œè¿›è¡Œæ›¿æ¢
```js
const newRows = rows.map((row, idx) => {
  if (removeLine.includes(idx)) {
    // æ­£åˆ™è¡¨è¾¾å¼æ›¿æ¢å®Œæ•´çš„console.logè¯­å¥ 
    return row.replace(/console\.log\((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*\)[;\n]?/g, '')
  }
  return row
})
const newContent = newRows.join(`\n`)

return newContent
```

## æµ‹è¯•

æˆ‘ä»¬éªŒè¯ä¸‹æ•ˆæœã€‚è¿™ä¸ªæ–‡ä»¶ä¸­æœ‰å¤šä¸ªconsoleè¯­å¥

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3e56098d9bca4eec9f2ad1ae423f90ba~tplv-k3u1fbpfcp-watermark.image?)

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3a82e9e26ee34ce7b58d58989a1a18aa~tplv-k3u1fbpfcp-watermark.image?)

ååˆ†å®Œç¾ï¼ï¼ï¼

ä»Šå¤©çš„åˆ†äº«å°±åˆ°è¿™äº†ï¼Œæ„Ÿè°¢ä½ çš„è§‚çœ‹ï¼Œå¦‚æœ‰é”™è¯¯çš„åœ°æ–¹ï¼Œæ¬¢è¿æŒ‡æ­£ï¼

æœ€åé™„ä¸Šæˆ‘çš„æ’ä»¶å’Œloader

### ğŸš€ viteæ’ä»¶: rollup-plugin-remove-others-console

æ’ä»¶åœ°å€ï¼šhttps://www.npmjs.com/package/rollup-plugin-remove-others-console

githubåœ°å€ï¼šhttps://github.com/mmdctjj/rollup-plugin-remove-others-console

### ğŸš€ webpack loader: remove-others-console-loader

loaderåœ°å€ï¼šhttps://www.npmjs.com/package/remove-others-console-loader

githubåœ°å€ï¼šhttps://github.com/mmdctjj/remove-others-console-loader

åŠŸèƒ½è¿˜ä¼šç»§ç»­å®Œå–„ï¼Œæ¬¢è¿starâ­