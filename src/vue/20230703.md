---
title: Vue3ä½¿ç”¨hookå°è£…åª’ä½“æŸ¥è¯¢å’Œäº‹ä»¶ç›‘å¬ï¼Œä½¿Vueçš„å¼€å‘æ›´åŠ ä¸æ»‘ğŸš€ğŸš€ğŸš€
isTimeLine: true
date: 2023-07-03
category:
  - å‰ç«¯
tag:
  - JavaScript
  - Vue
---
> æ–‡ç« åŒæ­¥åœ¨å…¬ä¼—å·ï¼šèŒèŒå“’è‰å¤´å°†å†›ï¼Œæ¬¢è¿å…³æ³¨

jsä¸­åª’ä½“æŸ¥è¯¢çš„ä¸»è¦æ–¹æ³•æ˜¯ä½¿ç”¨windowå¯¹è±¡ä¸‹çš„`matchMedia`å¯¹è±¡ï¼ŒæŸ¥è¯¢è¯­å¥å’ŒCSSåª’ä½“æŸ¥è¯¢ä¸€æ ·ã€‚

### å°è£…åª’ä½“æŸ¥è¯¢

é¦–å…ˆæˆ‘ä»¬å…ˆçœ‹ç›‘å¬ç³»ç»Ÿä¸»é¢˜è‰²çš„ä¾‹å­

- é¦–å…ˆåˆ›å»ºåª’ä½“æŸ¥è¯¢å¯¹è±¡
- æ ¹æ®æŸ¥è¯¢ç»“æœè®¾ç½®å¯¹åº”çš„å€¼
- ç„¶åå»ºç«‹ç›‘å¬äº‹ä»¶ï¼Œå¹¶ä¸”åœ¨é€€å‡ºæ—¶å–æ¶ˆç›‘å¬

```js
export const useTheme = () => {

  // é¦–å…ˆåˆ›å»ºåª’ä½“æŸ¥è¯¢å¯¹è±¡
  const themeMedia = matchMedia("(prefers-color-scheme: light)")
  // æ ¹æ®æŸ¥è¯¢ç»“æœè®¾ç½®å¯¹åº”çš„å€¼
  const theme = ref(themeMedia.matches ? 'light' : 'dark')

  const onChange = (e: MediaQueryListEvent) => theme.value = e.matches ? 'light' : 'dark'
  
  watchEffect((onCleanup) => {
    //  ç„¶åå»ºç«‹ç›‘å¬äº‹ä»¶
    themeMedia.addEventListener('change', onChange)
    // å¹¶ä¸”åœ¨é€€å‡ºæ—¶å–æ¶ˆç›‘å¬
    onCleanup(() => themeMedia.removeEventListener('change', onChange))
  })

  return theme;
}
```
æˆ‘ä»¬æµ‹è¯•ä¸‹
```js
const theme = useTheme()

watchEffect(() => console.log(theme.value, 'theme'))
```
![theme.gif](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/37e33588ee4b40438365db6841af4326~tplv-k3u1fbpfcp-watermark.image?)
å¦‚æœæˆ‘ä»¬å…¶ä»–æŸ¥è¯¢æŸ¥è¯¢ï¼Œæˆ‘ä»¬éœ€è¦é‡æ–°è®¾ç½®æ–°çš„å€¼ï¼Œæ‰€ä»¥ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°è£…ä¸€ä¸ªæ›´é€šç”¨çš„åª’ä½“æŸ¥è¯¢hookï¼Œå¦‚ä¸‹ï¼Œ
```js
export const useMatchMedia = (query: string) => {

  const themeMedia = matchMedia(query)

  const match = ref(themeMedia.matches)

  const onChange = (e: MediaQueryListEvent) => match.value = e.matches

  watchEffect((onCleanup) => {
    
    themeMedia.addEventListener('change', onChange)

    onCleanup(() => themeMedia.removeEventListener('change', onChange))
  })

  return match
}
```
è¿™ä¸ªä¾‹å­é‡Œï¼Œæˆ‘ä»¬ä¸å†å¯¹ç‰¹å®šçš„åª’ä½“æŸ¥è¯¢å€¼åšå¤„ç†ï¼ŒåŒæ—¶ï¼Œæˆ‘ä»¬å°†æŸ¥è¯¢è¯­å¥ä½œä¸ºåŠ¨æ€å˜é‡ï¼Œå°†ç»“æœå¤„ç†äº¤ç»™å¼€å‘è€…ã€‚

æˆ‘ä»¬ä½¿ç”¨é€šç”¨çš„hooké‡å†™ç›‘å¬ç³»ç»Ÿä¸»é¢˜è‰²çš„hookï¼Œå¦‚ä¸‹ï¼š
```js
export const useTheme = () => {

  const theme = useMatchMedia("(prefers-color-scheme: light)")

  const theme = ref(themeMedia.matches ? 'light' : 'dark')

  return theme  ? 'light' : 'dark'
}
```
æ˜¯ä¸æ˜¯è¿™æ ·æ›´ç®€æ´äº†ã€‚

### å°è£…äº‹ä»¶ç›‘å¬

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†çœ‹ç¬¬äºŒä¸ªç®€å•çš„ä¾‹å­ï¼Œç›‘å¬ç½‘ç»œçŠ¶æ€ã€‚

ç›‘å¬ç½‘ç»œçŠ¶æ€ï¼Œä¸»è¦é€šè¿‡ç›‘å¬`navigator.onLine`çš„å˜åŒ–ï¼Œå€¼çš„å˜åŒ–å¯ä»¥é€šè¿‡addEventListeneræ–¹æ³•ï¼Œ

æœ‰äº†å°è£…åª’ä½“æŸ¥è¯¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬é¦–å…ˆä¼šæƒ³åˆ°å°è£…äº‹ä»¶ç›‘å¬çš„å€¼çš„å˜åŒ–å¯ä»¥é€šè¿‡addEventListeneræ–¹æ³•ï¼Œæˆä¸ºä¸€ä¸ªé€šç”¨çš„é’©å­å‡½æ•°ã€‚å¦‚ä¸‹ï¼š
```js
export const useEventListener = <K extends keyof WindowEventMap>(
  target: K,
  listener: (ev: WindowEventMap[K]) => any
) => {

  watchEffect((onCleanup) => {

    addEventListener(target, listener)

    onCleanup(() => removeEventListener(target, listener))
  })
}
```
æ­¤æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿™æ ·å°è£…ç›‘å¬ç½‘ç»œçŠ¶æ€çš„hookäº†
```js
export const useNetWork = () => {
  
  const isOnLine = ref(navigator.onLine)

  const setOnLine = () => isOnLine.value = true
  const setOffLine = () => isOnLine.value = false

  useEventListener('online', setOnLine)
  useEventListener('offline', setOffLine)
  
  return isOnLine
}
```
æˆ‘ä»¬æµ‹è¯•ä¸‹
```js
const isOnLine = useNetWork()

watchEffect(() => console.log(isOnLine.value, 'isOnLine'))

<h1 v-if="isOnLine">onLine</h1>
<h1 v-else>offLine</h1>
```
![offline.gif](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/84a306c2d8b54d238cf32f8ba9473556~tplv-k3u1fbpfcp-watermark.image?)
æ¥ä¸‹æ¥æˆ‘ä»¬æµ‹è¯•ä¸‹å…¶ä»–çš„ç›‘å¬äº‹ä»¶ï¼Œæ¯”å¦‚ç›‘å¬scrolläº‹ä»¶ã€‚
```js
useEventListener('scroll', () => console.log('scroll'))
```

![scroll.gif](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d43ab372521e436ba7099877db0b639c~tplv-k3u1fbpfcp-watermark.image?)

åŠŸèƒ½æ˜¯æ­£å¸¸çš„ï¼Œä½†æ˜¯é¡ºç†æˆç« ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å†™ä¸€ä¸ªé˜²æŠ–å‡½æ•°
```js
export const debounce = (
  fn: (...args: any[]) => void,
  delay: number
) => {

  let timer: NodeJS.Timeout
  
  return  (...args: any[]) => {
  
    if (timer) clearTimeout(timer)
  
    timer = setTimeout(() => {

      fn.apply(this, args)

    }, delay)
  }
}
```

```js
useEventListener('scroll', debounce(() => console.log('scroll'), 200))
```

![scroll2.gif](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a64954ae2f234f7f80c2c9d2cd727664~tplv-k3u1fbpfcp-watermark.image?)

å¥½äº†ä»Šå¤©çš„åˆ†äº«åˆ°è¿™äº†ï¼Œå¦‚æœæ–‡ç« ä¸­æœ‰çº°æ¼çš„åœ°æ–¹æ¬¢è¿æŒ‡æ­£ï¼Œæˆ‘åŠæ—¶ä¿®æ”¹ï¼Œæ„Ÿè°¢ä½ çš„é˜…è¯»

è§‰å¾—æ–‡ç« è¿˜ä¸é”™å¯ä»¥å…³æ³¨æˆ‘çš„å…¬ä¼—å·ï¼Œæˆ–è€…ç‚¹ä¸ªèµå†èµ°å§ï¼Œååˆ†æ„Ÿè°¢ï¼ï¼ï¼