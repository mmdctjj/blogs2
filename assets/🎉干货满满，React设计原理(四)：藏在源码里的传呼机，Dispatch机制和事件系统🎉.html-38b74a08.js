import{_ as p}from"./plugin-vue_export-helper-c27b6911.js";import{r as i,o,c,a as s,b as a,e as t,f as l}from"./app-802353c0.js";const r={},u={href:"https://juejin.cn/post/7241567583504728119",target:"_blank",rel:"noopener noreferrer"},d={href:"https://juejin.cn/post/7242249906257363001",target:"_blank",rel:"noopener noreferrer"},v={href:"https://juejin.cn/post/7248982532728602681",target:"_blank",rel:"noopener noreferrer"};function k(m,n){const e=i("ExternalLinkIcon");return o(),c("div",null,[n[3]||(n[3]=s("blockquote",null,[s("p",null,"æ–‡ç« åŒæ­¥æ›´æ–°åœ¨å…¬ä¼—å·ï¼šèŒèŒå“’è‰å¤´å°†å†›ï¼Œæ¬¢è¿å…³æ³¨")],-1)),n[4]||(n[4]=s("p",null,"å¥½ä¹…ä¸è§ï¼Œè¯¥ç³»åˆ—å·²ç»æ›´æ–°äº†ä¸‰ç¯‡äº†ï¼Œä¸Šæ–‡ä»‹ç»äº† React æ˜¯å¦‚ä½•é€šè¿‡ Lane æ¨¡å‹åˆ¤æ–­æ›´æ–°ä»»åŠ¡çš„ä¼˜å…ˆçº§çš„ï¼Œè§†é‡èšç„¦äº Lane æ¨¡å‹çš„åŸç†ï¼Œä»Šå¤©æˆ‘ä»¬è¯¦ç»†çœ‹çœ‹ Lane æ¨¡å‹å·¥ä½œå‰å‘ç”Ÿäº†å•¥ã€‚",-1)),n[5]||(n[5]=s("h3",{id:"ğŸ’¡-ç›¸å…³é˜…è¯»",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#ğŸ’¡-ç›¸å…³é˜…è¯»","aria-hidden":"true"},"#"),a(" ğŸ’¡ ç›¸å…³é˜…è¯»")],-1)),s("ul",null,[s("li",null,[s("a",u,[n[0]||(n[0]=a("ğŸ‰ å¹²è´§æ»¡æ»¡ï¼ŒReact è®¾è®¡åŸç†(ä¸€)ï¼šè—åœ¨æºç é‡Œçš„ç´§ç®å’’ ğŸ‰")),t(e)])]),s("li",null,[s("a",d,[n[1]||(n[1]=a("ğŸ‰ å¹²è´§æ»¡æ»¡ï¼ŒReact è®¾è®¡åŸç†(äºŒ)ï¼šè—åœ¨æºç é‡Œçš„ä¸¤ä¸ªåœˆ ğŸ‰")),t(e)])]),s("li",null,[s("a",v,[n[2]||(n[2]=a("ğŸ‰ å¹²è´§æ»¡æ»¡ï¼ŒReact è®¾è®¡åŸç†(ä¸‰)ï¼šè—åœ¨æºç é‡Œçš„æ’ä½èµ›ï¼ŒLane æ¨¡å‹ ğŸ‰")),t(e)])])]),n[6]||(n[6]=l(`<h2 id="ğŸ’-ç¬¬å››åº§å¤§å±±-äº‹ä»¶ç³»ç»Ÿ" tabindex="-1"><a class="header-anchor" href="#ğŸ’-ç¬¬å››åº§å¤§å±±-äº‹ä»¶ç³»ç»Ÿ" aria-hidden="true">#</a> ğŸ’ ç¬¬å››åº§å¤§å±±ï¼šäº‹ä»¶ç³»ç»Ÿ</h2><h3 id="ä¸€äº›è¡¨è±¡å’ŒåŸå› " tabindex="-1"><a class="header-anchor" href="#ä¸€äº›è¡¨è±¡å’ŒåŸå› " aria-hidden="true">#</a> ä¸€äº›è¡¨è±¡å’ŒåŸå› </h3><p>äº‹ä»¶ç³»ç»Ÿæ˜¯ååˆ†æœ‰è¶£ä½†ç¨æ˜¾å¤æ‚çš„æ¨¡å—ã€‚ä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œæˆ‘ä»¬å¸¦å…¥ä¸€ä¸ªé—®é¢˜ï¼šæˆ‘ä»¬è®¾ç½®çš„<code>onClick</code>æ–¹æ³•å¦‚ä½•è¢«æ‰§è¡Œçš„ï¼Ÿ</p><p>é¦–å…ˆï¼ŒReact å¯¹æµè§ˆå™¨åŸç”Ÿäº‹ä»¶è¿›è¡Œäº†å°è£…ï¼Œä¾‹å¦‚ï¼Œå½“ç”¨æˆ·é€šè¿‡<code>onClick</code>å±æ€§è§¦å‘äº¤äº’è¡Œä¸ºæ—¶ï¼ŒReact å…ˆå°†äº‹ä»¶è¿›è¡Œä¼˜åŒ–å¤„ç†ï¼Œç„¶åè½¬åŒ–ä¸ºåŸç”Ÿçš„ <code>click</code> äº‹ä»¶ã€‚</p><p>è¿™æ ·å°è£…çš„ç›®çš„ï¼Œ<strong>ä¸€æ–¹é¢</strong>å¯ä»¥è§£å†³ä¸åŒæµè§ˆå™¨çš„å…¼å®¹æ€§é—®é¢˜ï¼›</p><p><strong>å¦ä¸€æ–¹é¢</strong>å¯ä»¥å‡å°‘äº‹ä»¶å¤„ç†å‡½æ•°çš„æ•°é‡ï¼Œæé«˜æ€§èƒ½å’Œæ•ˆç‡ï¼Œæˆ‘ä»¬æä¾›å¦‚ä¸‹ç»„ä»¶</p><div class="language-jsx line-numbers-mode" data-ext="jsx"><pre class="language-jsx"><code><span class="token keyword">const</span> <span class="token function-variable function">handerClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;å…¬ä¼—å·ï¼šèŒèŒå“’è‰å¤´å°†å†›&quot;</span><span class="token punctuation">)</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>handerClick<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">btn</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åæŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å° -&gt; å®¡æŸ¥å…ƒç´  -&gt; äº‹ä»¶ç›‘å¬ï¼Œ</p><p align="center"><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b2f8707a60634c28b1c374369280293a~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1426&amp;h=588&amp;s=256323&amp;e=png&amp;b=ffffff" alt="image.png" width="50%"></p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ­¤æ—¶çš„ button å…ƒç´ ç»‘å®šçš„ click äº‹ä»¶ä¸º noopï¼Œ å½“æˆ‘ä»¬é€‰ä¸­å…¥å£ dom èŠ‚ç‚¹æ—¶æƒŠå¥‡çš„å‘ç°ï¼Œ#app (å…¥å£)èŠ‚ç‚¹è¢«ç»‘å®šäº†ä¸€å¤§å †çš„äº‹ä»¶</p><p align="center"><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ce921c881709448aa87794b7c45046c3~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1956&amp;h=1202&amp;s=521505&amp;e=png&amp;b=ffffff" alt="image.png" width="50%"></p><p>å…¶ä¸­çš„ document ä¸Šç»‘å®šçš„ click äº‹ä»¶æ˜¯å‡½æ•° dispatchDiscreteEventã€‚å¯ä»¥å…ˆè®°ä½è¿™ä¸ªå‡½æ•°ï¼Œåé¢è¿˜ä¼šæåˆ°ã€‚</p><blockquote><p>åœ¨ 16.8 åŠä¹‹å‰çš„ç‰ˆæœ¬ï¼Œè¿™äº›äº‹ä»¶ç›´æ¥è¢«ç»‘å®šåœ¨ document å…ƒç´ ä¸Šï¼Œè€Œä» 17.2 å¼€å§‹ï¼Œå°†å…¨å±€äº‹ä»¶ç»‘å®šåœ¨äº†å…¥å£ dom ä¸Šäº†ï¼Œè¿™ä¹ˆåšçš„å¥½å¤„åˆ©äºå¤šåº”ç”¨ï¼Œå› ä¸º react æ”¯æŒä¸€ä¸ª document ä¸‹æŒ‚åœ¨å¤šä¸ª React åº”ç”¨ï¼Œè¿™æ ·åšäº’ä¸å¹²æ‰°ã€‚</p><p align="center"><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5adcea459cbd40f199c99d444be48398~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=840&amp;h=650&amp;s=145843&amp;e=png&amp;b=ffffff" alt="image.png" width="50%"></p></blockquote><p><strong>è¿˜æœ‰ä¸€ä¸ªæ–¹é¢</strong>ï¼Œå®ƒå°†äº‹ä»¶å¤„ç†å‡½æ•°ç»‘å®šåˆ°ç»„ä»¶å®ä¾‹ä¸Šï¼Œè¿™æ ·å¯ä»¥é¿å…åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­æ‰‹åŠ¨ç»‘å®š<code>this</code>å…³é”®å­—ã€‚</p><h3 id="onclickæ–¹æ³•å¦‚ä½•è¢«æ‰§è¡Œçš„" tabindex="-1"><a class="header-anchor" href="#onclickæ–¹æ³•å¦‚ä½•è¢«æ‰§è¡Œçš„" aria-hidden="true">#</a> <code>onClick</code>æ–¹æ³•å¦‚ä½•è¢«æ‰§è¡Œçš„</h3><p>å³ä½¿æˆ‘ä»¬ä¸çœ‹ä»£ç ï¼Œæœ‰ä¸Šé¢çš„é“ºå«ï¼Œä¹Ÿå¯ä»¥æ˜ç™½ï¼Œ<code>onClick</code>æ–¹æ³•çš„å¤§è‡´ç»å†</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>=&gt; 1. è¯»å–onClickfæ–¹æ³•ï¼Œ
=&gt; 2. reactåˆå¹¶ä¼˜åŒ–å¤„ç†
=&gt; 3. æŒ‚è½½åœ¨docmentä¸Š
=&gt; 4. ç‚¹å‡»æ—¶è§¦å‘æ–¹æ³•
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬çŸ¥é“æ¯ä¸ª React åº”ç”¨çš„å…¥å£æ˜¯é€šè¿‡ createRoot å‡½æ•°ï¼Œæˆ‘ä»¬æ‰“å¼€æºç ï¼Œå°±å¯ä»¥çœ‹åˆ°è¯¥å‡½æ•°çš„ä¸€é¡¹å·¥ä½œæ˜¯ <code>listenToAllSupportedEvents</code>ï¼Œä¹Ÿå°±æ˜¯åœ¨ rootNode ç›‘å¬ æ‰€æœ‰æ”¯æŒçš„äº‹ä»¶ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">createRoot</span><span class="token punctuation">(</span><span class="token parameter">container<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// çœå»æ— å…³ä»£ç </span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>options <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> options <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// åˆå§‹åŒ–å‚æ•°</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">var</span> root <span class="token operator">=</span> <span class="token function">createContainer</span><span class="token punctuation">(</span>container<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> rootContainerElement <span class="token operator">=</span>
    container<span class="token punctuation">.</span>nodeType <span class="token operator">===</span> <span class="token constant">COMMENT_NODE</span> <span class="token operator">?</span> container<span class="token punctuation">.</span>parentNode <span class="token operator">:</span> container<span class="token punctuation">;</span>
  <span class="token function">listenToAllSupportedEvents</span><span class="token punctuation">(</span>rootContainerElement<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ReactDOMRoot</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ·±å…¥çš„ç ”ç©¶ï¼Œå¯ä»¥çœ‹åˆ° React æ ¹æ®äº‹ä»¶çš„ä¼˜å…ˆçº§åˆ†ä¸ºï¼šç¦»æ•£äº‹ä»¶ã€è¿ç»­äº‹ä»¶ã€æ™®é€šäº‹ä»¶ï¼Œåœ¨ createEventListenerWrapperWithPriority ä¸­ï¼Œé€šè¿‡å½“å‰äº‹ä»¶çš„çº§åˆ«ï¼Œåˆ†å‘å¯¹åº”çš„äº‹ä»¶ç›‘å¬å™¨</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">createEventListenerWrapperWithPriority</span><span class="token punctuation">(</span>
  <span class="token parameter">targetContainer<span class="token punctuation">,</span>
  domEventName<span class="token punctuation">,</span>
  eventSystemFlags</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> eventPriority <span class="token operator">=</span> <span class="token function">getEventPriority</span><span class="token punctuation">(</span>domEventName<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> listenerWrapper<span class="token punctuation">;</span>

  <span class="token keyword">switch</span> <span class="token punctuation">(</span>eventPriority<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token literal-property property">DiscreteEventPriority</span><span class="token operator">:</span>
      listenerWrapper <span class="token operator">=</span> dispatchDiscreteEvent<span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>

    <span class="token keyword">case</span> <span class="token literal-property property">ContinuousEventPriority</span><span class="token operator">:</span>
      listenerWrapper <span class="token operator">=</span> dispatchContinuousEvent<span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>

    <span class="token keyword">case</span> <span class="token literal-property property">DefaultEventPriority</span><span class="token operator">:</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      listenerWrapper <span class="token operator">=</span> dispatchEvent<span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token function">listenerWrapper</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>
    <span class="token keyword">null</span><span class="token punctuation">,</span>
    domEventName<span class="token punctuation">,</span>
    eventSystemFlags<span class="token punctuation">,</span>
    targetContainer
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¥ç€ï¼Œæˆ‘ä»¬æ¥åœ¨æ¥çœ‹çœ‹åç»­çš„æ“ä½œ</p><p><code>addTrappedEventListener</code> å‡½æ•°æ˜¯ç”¨äºæ·»åŠ äº‹ä»¶ç›‘å¬å™¨çš„å…¥å£å‡½æ•°ï¼Œé€šè¿‡è¯¥å‡½æ•°ä¸­çš„ <code>createEventListenerWrapperWithPriority</code>å‡½æ•°ï¼Œæ ¹æ®äº‹ä»¶ä¼˜å…ˆçº§è¿”å›ç›¸åº”çš„äº‹ä»¶ç›‘å¬å™¨åŒ…è£…å‡½æ•° <code>listenerWrapper</code>ã€‚æ¥ç€ï¼Œåœ¨ <code>addEventCaptureListener</code> æ•è·é˜¶æ®µæ·»åŠ äº‹ä»¶ç›‘å¬å™¨ã€‚å®ƒé€šè¿‡è°ƒç”¨ <code>target.addEventListener</code> å°†ç›‘å¬å™¨ <code>listener</code> æ·»åŠ åˆ°ç›®æ ‡å…ƒç´  <code>target</code> ä¸Šï¼Œå¹¶æŒ‡å®šä¸ºæ•è·é˜¶æ®µï¼ˆtrueï¼‰ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">addTrappedEventListener</span><span class="token punctuation">(</span>
  <span class="token parameter">targetContainer<span class="token punctuation">,</span>
  domEventName<span class="token punctuation">,</span>
  eventSystemFlags<span class="token punctuation">,</span>
  isCapturePhaseListener<span class="token punctuation">,</span>
  isDeferredListenerForLegacyFBSupport</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> listener <span class="token operator">=</span> <span class="token function">createEventListenerWrapperWithPriority</span><span class="token punctuation">(</span>
    targetContainer<span class="token punctuation">,</span>
    domEventName<span class="token punctuation">,</span>
    eventSystemFlags
  <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// If passive option is not supported, then the event will be</span>
  <span class="token comment">// active and not passive.</span>

  <span class="token keyword">var</span> isPassiveListener <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>

  <span class="token comment">// æ ¹æ® passiveBrowserEventsSupported å˜é‡çš„å€¼ï¼Œç¡®å®šæ˜¯å¦ä½¿ç”¨è¢«åŠ¨äº‹ä»¶ç›‘å¬å™¨</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>passiveBrowserEventsSupported<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>
      domEventName <span class="token operator">===</span> <span class="token string">&quot;touchstart&quot;</span> <span class="token operator">||</span>
      domEventName <span class="token operator">===</span> <span class="token string">&quot;touchmove&quot;</span> <span class="token operator">||</span>
      domEventName <span class="token operator">===</span> <span class="token string">&quot;wheel&quot;</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      isPassiveListener <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  targetContainer <span class="token operator">=</span> targetContainer<span class="token punctuation">;</span>
  <span class="token keyword">var</span> unsubscribeListener<span class="token punctuation">;</span> <span class="token comment">// When legacyFBSupport is enabled, it&#39;s for when we</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>isCapturePhaseListener<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isPassiveListener <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      unsubscribeListener <span class="token operator">=</span> <span class="token function">addEventCaptureListenerWithPassiveFlag</span><span class="token punctuation">(</span>
        targetContainer<span class="token punctuation">,</span>
        domEventName<span class="token punctuation">,</span>
        listener<span class="token punctuation">,</span>
        isPassiveListener
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      unsubscribeListener <span class="token operator">=</span> <span class="token function">addEventCaptureListener</span><span class="token punctuation">(</span>
        targetContainer<span class="token punctuation">,</span>
        domEventName<span class="token punctuation">,</span>
        listener
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isPassiveListener <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      unsubscribeListener <span class="token operator">=</span> <span class="token function">addEventBubbleListenerWithPassiveFlag</span><span class="token punctuation">(</span>
        targetContainer<span class="token punctuation">,</span>
        domEventName<span class="token punctuation">,</span>
        listener<span class="token punctuation">,</span>
        isPassiveListener
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      unsubscribeListener <span class="token operator">=</span> <span class="token function">addEventBubbleListener</span><span class="token punctuation">(</span>
        targetContainer<span class="token punctuation">,</span>
        domEventName<span class="token punctuation">,</span>
        listener
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>createEventListenerWrapperWithPriority</code> å†…éƒ¨é€»è¾‘å¦‚ä¸‹ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">createEventListenerWrapperWithPriority</span><span class="token punctuation">(</span>
  <span class="token parameter">targetContainer<span class="token punctuation">,</span>
  domEventName<span class="token punctuation">,</span>
  eventSystemFlags</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> eventPriority <span class="token operator">=</span> <span class="token function">getEventPriority</span><span class="token punctuation">(</span>domEventName<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> listenerWrapper<span class="token punctuation">;</span>

  <span class="token keyword">switch</span> <span class="token punctuation">(</span>eventPriority<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token literal-property property">DiscreteEventPriority</span><span class="token operator">:</span>
      listenerWrapper <span class="token operator">=</span> dispatchDiscreteEvent<span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>

    <span class="token keyword">case</span> <span class="token literal-property property">ContinuousEventPriority</span><span class="token operator">:</span>
      listenerWrapper <span class="token operator">=</span> dispatchContinuousEvent<span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>

    <span class="token keyword">case</span> <span class="token literal-property property">DefaultEventPriority</span><span class="token operator">:</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      listenerWrapper <span class="token operator">=</span> dispatchEvent<span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token function">listenerWrapper</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>
    <span class="token keyword">null</span><span class="token punctuation">,</span>
    domEventName<span class="token punctuation">,</span>
    eventSystemFlags<span class="token punctuation">,</span>
    targetContainer
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>addEventCaptureListener</code> é€»è¾‘å¦‚ä¸‹ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">addEventCaptureListener</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> eventType<span class="token punctuation">,</span> listener</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  target<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>eventType<span class="token punctuation">,</span> listener<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> listener<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ğŸš€-dispatch-æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#ğŸš€-dispatch-æœºåˆ¶" aria-hidden="true">#</a> ğŸš€ Dispatch æœºåˆ¶</h3><p>React çš„ Dispatcher æœºåˆ¶æ˜¯ç”¨äºç®¡ç†å’Œè°ƒåº¦æ›´æ–°çš„å†…éƒ¨æœºåˆ¶ï¼Œå®ƒè´Ÿè´£åè°ƒå’Œæ‰§è¡Œæ›´æ–°ä»»åŠ¡çš„è¿‡ç¨‹ã€‚ä¸‹é¢æ˜¯ React Dispatcher æœºåˆ¶çš„è¯¦ç»†ä»‹ç»å’ŒåŸç†ï¼š</p><ol><li><p>è°ƒåº¦å™¨ï¼ˆSchedulerï¼‰ï¼šè°ƒåº¦å™¨æ˜¯ Dispatcher çš„æ ¸å¿ƒç»„ä»¶ï¼Œè´Ÿè´£ç®¡ç†å’Œè°ƒåº¦ä»»åŠ¡çš„æ‰§è¡Œã€‚å®ƒç»´æŠ¤äº†å¤šä¸ªä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œç”¨äºå­˜å‚¨ä¸åŒä¼˜å…ˆçº§çš„ä»»åŠ¡ã€‚è°ƒåº¦å™¨æ ¹æ®ä»»åŠ¡çš„ä¼˜å…ˆçº§æ¥ç¡®å®šæ‰§è¡Œé¡ºåºï¼Œä»¥æä¾›æ›´å¥½çš„æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒã€‚</p></li><li><p>è°ƒåº¦å™¨ä»»åŠ¡ï¼ˆScheduler Taskï¼‰ï¼šè°ƒåº¦å™¨ä»»åŠ¡è¡¨ç¤ºä¸€ä¸ªæ›´æ–°ä»»åŠ¡ï¼Œå¯ä»¥æ˜¯ç»„ä»¶çš„æ›´æ–°ã€å‰¯ä½œç”¨çš„å¤„ç†ç­‰ã€‚å½“éœ€è¦è§¦å‘æ›´æ–°æ—¶ï¼ŒReact ä¼šåˆ›å»ºä¸€ä¸ªè°ƒåº¦å™¨ä»»åŠ¡ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°ç›¸åº”çš„ä¼˜å…ˆçº§é˜Ÿåˆ—ä¸­ã€‚</p></li><li><p>è°ƒåº¦ä¼˜å…ˆçº§ï¼ˆLanesï¼‰ï¼šè°ƒåº¦ä¼˜å…ˆçº§ç”¨äºè¡¨ç¤ºä¸åŒä»»åŠ¡çš„ä¼˜å…ˆçº§ã€‚React ä½¿ç”¨ Lanes æ¥ç®¡ç†ä»»åŠ¡çš„ä¼˜å…ˆçº§ï¼Œä¾‹å¦‚åŒæ­¥æ›´æ–°ã€æ‰¹é‡æ›´æ–°ã€é—²ç½®æ›´æ–°ç­‰ã€‚è°ƒåº¦å™¨æ ¹æ® Lanes æ¥å†³å®šä»»åŠ¡çš„æ‰§è¡Œé¡ºåºã€‚</p></li><li><p>æ‰¹é‡æ›´æ–°ï¼ˆBatchingï¼‰ï¼šä¸ºäº†æé«˜æ€§èƒ½ï¼ŒReact ä½¿ç”¨æ‰¹é‡æ›´æ–°ç­–ç•¥ã€‚å®ƒä¼šå°†å¤šä¸ªæ›´æ–°ä»»åŠ¡åˆå¹¶ä¸ºä¸€ä¸ªæ‰¹é‡æ›´æ–°ä»»åŠ¡ï¼Œç„¶ååœ¨é€‚å½“çš„æ—¶æœºè¿›è¡Œæ‰§è¡Œã€‚è¿™æ ·å¯ä»¥å‡å°‘ä¸å¿…è¦çš„é‡ç»˜å’Œå¸ƒå±€è®¡ç®—ï¼Œæé«˜æ€§èƒ½å’Œæ•ˆç‡ã€‚</p></li><li><p>è°ƒåº¦è¿‡ç¨‹ï¼šå½“éœ€è¦è¿›è¡Œç»„ä»¶æ›´æ–°æ—¶ï¼ŒReact ä¼šåˆ›å»ºä¸€ä¸ªè°ƒåº¦å™¨ä»»åŠ¡ï¼Œå¹¶æ ¹æ®ä»»åŠ¡çš„ä¼˜å…ˆçº§å°†å…¶æ·»åŠ åˆ°ç›¸åº”çš„ä¼˜å…ˆçº§é˜Ÿåˆ—ä¸­ã€‚ç„¶åï¼Œè°ƒåº¦å™¨ä¼šæ ¹æ®å½“å‰çš„è°ƒåº¦ä¼˜å…ˆçº§é€‰æ‹©å¹¶æ‰§è¡Œä»»åŠ¡ã€‚æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼ŒReact ä¼šè¿›è¡Œç»„ä»¶çš„æ¸²æŸ“ã€è™šæ‹Ÿ DOM çš„æ¯”è¾ƒç­‰æ“ä½œï¼Œä»¥ç¡®å®šéœ€è¦æ›´æ–°çš„éƒ¨åˆ†ã€‚</p></li><li><p>ä»»åŠ¡ä¼˜å…ˆçº§çš„è°ƒåº¦ï¼šReact çš„è°ƒåº¦å™¨æ ¹æ®ä»»åŠ¡çš„ä¼˜å…ˆçº§æ¥å†³å®šæ‰§è¡Œé¡ºåºã€‚è¾ƒé«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡ä¼šè¢«ç«‹å³æ‰§è¡Œï¼Œè€Œè¾ƒä½ä¼˜å…ˆçº§çš„ä»»åŠ¡åˆ™å¯èƒ½ä¼šè¢«æ¨è¿Ÿæˆ–åˆå¹¶ã€‚è¿™ç§æœºåˆ¶å¯ä»¥ç¡®ä¿é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡èƒ½å¤ŸåŠæ—¶å¾—åˆ°å¤„ç†ï¼Œè€Œä½ä¼˜å…ˆçº§çš„ä»»åŠ¡åˆ™å¯ä»¥ç­‰å¾…åˆé€‚çš„æ—¶æœºå†æ‰§è¡Œï¼Œä»¥æé«˜æ€§èƒ½å’Œå“åº”æ€§ã€‚</p></li></ol><p>é€šè¿‡ Dispatcher æœºåˆ¶ï¼ŒReact èƒ½å¤Ÿçµæ´»åœ°ç®¡ç†å’Œè°ƒåº¦ç»„ä»¶çš„æ›´æ–°ä»»åŠ¡ã€‚å®ƒæ ¹æ®ä»»åŠ¡çš„ä¼˜å…ˆçº§ï¼Œåˆå¹¶å’Œæ‰¹é‡å¤„ç†æ›´æ–°ä»»åŠ¡ï¼Œä»¥æä¾›æ›´å¥½çš„æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒã€‚åŒæ—¶ï¼ŒDispatcher æœºåˆ¶ä¹Ÿä¿è¯äº†ç»„ä»¶çš„æ›´æ–°è¿‡ç¨‹æ˜¯æœ‰åºä¸”å¯æ§çš„ï¼Œé¿å…äº†ä¸å¿…è¦çš„é‡å¤è®¡ç®—å’Œæ¸²æŸ“ã€‚</p><h2 id="ğŸ‰-æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#ğŸ‰-æ€»ç»“" aria-hidden="true">#</a> ğŸ‰ æ€»ç»“</h2><p>åœ¨ React ä¸­ï¼Œäº‹ä»¶ç³»ç»Ÿå’Œ Dispatcher æœºåˆ¶æ˜¯ä¸€èµ·å·¥ä½œçš„ï¼Œä½†å®ƒä»¬çš„èŒè´£å’Œä½œç”¨ç•¥æœ‰ä¸åŒã€‚</p><p>äº‹ä»¶ç³»ç»Ÿä¸»è¦è´Ÿè´£å¤„ç†ç”¨æˆ·äº¤äº’è¡Œä¸ºï¼Œä¾‹å¦‚ç‚¹å‡»ã€è¾“å…¥ç­‰äº‹ä»¶çš„ç»‘å®šå’Œè§¦å‘ã€‚å½“ç”¨æˆ·è§¦å‘ä¸€ä¸ªäº‹ä»¶æ—¶ï¼Œäº‹ä»¶ç³»ç»Ÿä¼šè°ƒç”¨ç›¸åº”çš„äº‹ä»¶å¤„ç†å‡½æ•°ã€‚</p><p>Dispatcher æœºåˆ¶åˆ™æ˜¯ç”¨äºç®¡ç†å’Œè°ƒåº¦ç»„ä»¶çš„æ›´æ–°ä»»åŠ¡ã€‚å®ƒè´Ÿè´£æ ¹æ®ä»»åŠ¡çš„ä¼˜å…ˆçº§æ¥å†³å®šä»»åŠ¡çš„æ‰§è¡Œé¡ºåºï¼Œå¹¶æ‰§è¡Œç›¸åº”çš„æ›´æ–°ä»»åŠ¡ã€‚è¿™äº›æ›´æ–°ä»»åŠ¡å¯èƒ½æ˜¯ç”±äº‹ä»¶ç³»ç»Ÿè§¦å‘çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶ä»–è§¦å‘æ›´æ–°çš„åŸå› ï¼Œä¾‹å¦‚ç»„ä»¶çŠ¶æ€çš„æ”¹å˜ã€å¼‚æ­¥æ•°æ®çš„æ›´æ–°ç­‰ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œå½“ç”¨æˆ·è§¦å‘ä¸€ä¸ªäº‹ä»¶æ—¶ï¼Œäº‹ä»¶ç³»ç»Ÿä¼šè°ƒç”¨ç›¸åº”çš„äº‹ä»¶å¤„ç†å‡½æ•°ã€‚åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­ï¼Œå¯èƒ½ä¼šå¼•å‘ç»„ä»¶çš„æ›´æ–°éœ€æ±‚ï¼Œä¾‹å¦‚ä¿®æ”¹ç»„ä»¶çš„çŠ¶æ€æˆ–è§¦å‘çˆ¶ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ã€‚è¿™æ—¶ï¼ŒReact ä¼šåˆ›å»ºä¸€ä¸ªæ›´æ–°ä»»åŠ¡ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ° Dispatcher ä¸­çš„ç›¸åº”ä¼˜å…ˆçº§é˜Ÿåˆ—ä¸­ã€‚</p><p>Dispatcher ä¼šæ ¹æ®ä»»åŠ¡çš„ä¼˜å…ˆçº§ï¼Œé€‰æ‹©å¹¶æ‰§è¡Œä»»åŠ¡ã€‚å®ƒä¼šè°ƒç”¨ç»„ä»¶çš„ render æ–¹æ³•ç”Ÿæˆæ–°çš„è™šæ‹Ÿ DOMï¼Œå¹¶é€šè¿‡ä¸ä¹‹å‰çš„è™šæ‹Ÿ DOM è¿›è¡Œæ¯”è¾ƒï¼Œæ‰¾å‡ºå·®å¼‚å¹¶åº”ç”¨åˆ°å®é™…çš„ DOM ä¸Šã€‚è¿™ä¸ªè¿‡ç¨‹ä¹ŸåŒ…æ‹¬äº†ç»„ä»¶çš„æ›´æ–°ã€å‰¯ä½œç”¨çš„å¤„ç†ã€çŠ¶æ€çš„æ›´æ–°ç­‰ã€‚</p><p>æ‰€ä»¥ï¼Œå¯ä»¥è¯´äº‹ä»¶ç³»ç»Ÿé€šè¿‡è§¦å‘äº‹ä»¶æ¥æ„ŸçŸ¥éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡ï¼Œè€Œ Dispatcher æœºåˆ¶å…·ä½“æ‰§è¡Œè¿™äº›ä»»åŠ¡å¹¶ç®¡ç†ç»„ä»¶çš„æ›´æ–°è¿‡ç¨‹ã€‚å®ƒä»¬ååŒå·¥ä½œï¼Œç¡®ä¿ç»„ä»¶çš„æ›´æ–°èƒ½å¤Ÿè¢«åŠæ—¶å¤„ç†ï¼Œå¹¶æä¾›è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒã€‚</p><p align="center"><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f1fd46c99b6d4d54af60897dac438c14~tplv-k3u1fbpfcp-zoom-1.image" alt="image.png"></p>`,40))])}const f=p(r,[["render",k],["__file","ğŸ‰å¹²è´§æ»¡æ»¡ï¼ŒReactè®¾è®¡åŸç†(å››)ï¼šè—åœ¨æºç é‡Œçš„ä¼ å‘¼æœºï¼ŒDispatchæœºåˆ¶å’Œäº‹ä»¶ç³»ç»ŸğŸ‰.html.vue"]]);export{f as default};
