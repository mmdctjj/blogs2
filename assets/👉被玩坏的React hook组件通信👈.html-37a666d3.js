import{_ as o}from"./plugin-vue_export-helper-c27b6911.js";import{r as c,o as i,c as l,f as e,a as s,b as a,e as p}from"./app-6f8bae2c.js";const u={},r={href:"https://codesandbox.io/s/vibrant-rain-eqeh6g?file=/index.tsx:168-674",target:"_blank",rel:"noopener noreferrer"},d={href:"https://juejin.cn/post/7222575963565375544#heading-3",target:"_blank",rel:"noopener noreferrer"};function k(v,n){const t=c("ExternalLinkIcon");return i(),l("div",null,[n[3]||(n[3]=e(`<p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ã€ŒèŒèŒå“’è‰å¤´å°†å†›ã€ï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥å…³æ³¨æˆ‘å…¬ä¼—å·ã€ŒèŒèŒå“’è‰å¤´å°†å†›ã€ï¼Œè¿‘æœŸæœ‰æŠ½å¥–å“¦ï½</p><p>ä»Šå¤©ç»™å¤§å®¶è¡¨æ¼”ä¸ªæ‚æŠ€ï¼Œæœ‰èµçš„æ§ä¸ªèµåœºï¼Œæ²¡èµçš„æ§ä¸ªäººåœºï¼Œå¯æ€œå¯æ€œæˆ‘å§ï¼ï¼ï¼</p><h3 id="ğŸ‘‰useimperativehandleæ‚æŠ€" tabindex="-1"><a class="header-anchor" href="#ğŸ‘‰useimperativehandleæ‚æŠ€" aria-hidden="true">#</a> ğŸ‘‰<code>useImperativeHandle</code>æ‚æŠ€</h3><p>è¯­æ³•ï¼š<code>useImperativeHandle(ref, createHandle, dependencies?)</code></p><p>ç”¨æ³•ï¼š</p><p>ğŸ‰ <code>å‘çˆ¶ç»„ä»¶æš´éœ²ä¸€ä¸ªè‡ªå®šä¹‰çš„ ref å¥æŸ„</code></p><p>ğŸ‰ <code>æš´éœ²ä½ è‡ªå·±çš„å‘½ä»¤å¼æ–¹æ³•</code></p><p>æˆ‘ä»¬é‡‡ç”¨è‡ªå®šä¹‰å‘½ä»¤æ–¹æ³•çš„æ–¹å¼è¿›è¡Œè¡¨æ¼”ï¼Œå¦‚ä¸‹</p><p>ğŸ çˆ¶ç»„ä»¶æ”¹å˜å­ç»„ä»¶çš„å€¼</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>import { useRef } from &#39;react&#39;;
import Child from &#39;./Child.js&#39;;

export default function Form() {
  const ref = useRef(null);

  function handleClick() {
    ref.current.buy(&#39;apple&#39;);
  }

  return (
    &lt;form&gt;
      &lt;Child label=&quot;Enter your name:&quot; ref={ref} /&gt;
      &lt;button type=&quot;button&quot; onClick={handleClick}&gt;
        Edit
      &lt;/button&gt;
    &lt;/form&gt;
  );
}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>import { forwardRef, useImperativeHandle, useState } from &#39;react&#39;;

const Child = forwardRef(function MyInput(props, ref) {

  const [goods, setGoods] = useState(null)
  
  useImperativeHandle(ref, () =&gt; {
    return {
      buy (goods) {
        setGoods(goods)
      },
    };
  }, []);

  return &lt;div&gt;{goods}&lt;/div&gt;;
});

export default Child;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ğŸ‘‰ä½¿ç”¨è®¾è®¡æ¨¡å¼æ‚æŠ€" tabindex="-1"><a class="header-anchor" href="#ğŸ‘‰ä½¿ç”¨è®¾è®¡æ¨¡å¼æ‚æŠ€" aria-hidden="true">#</a> ğŸ‘‰ä½¿ç”¨<code>è®¾è®¡æ¨¡å¼</code>æ‚æŠ€</h3>`,12)),s("p",null,[s("a",r,[n[0]||(n[0]=a("åœ¨çº¿Demoçœ‹è¿™é‡Œ")),p(t)])]),s("p",null,[n[2]||(n[2]=a("è¿™é‡Œéœ€è¦å€ŸåŠ©ä¹‹å‰æåˆ°çš„")),s("a",d,[n[1]||(n[1]=a("ä¸­ä»‹è€…æ¨¡å¼")),p(t)])]),n[4]||(n[4]=e(`<div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useEffect<span class="token punctuation">,</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> mediator <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./index&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// äº‹ä»¶è®¢é˜…å™¨</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">useGetEvent</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">topic</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> sub <span class="token operator">=</span> mediator<span class="token punctuation">.</span><span class="token function">install</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>data<span class="token punctuation">,</span> setData<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    sub<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> setData<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> data<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// äº‹ä»¶å‘å¸ƒå™¨</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">useSetEvent</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">topic<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> sub <span class="token operator">=</span> mediator<span class="token punctuation">.</span><span class="token function">install</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> sub<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>value<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-jsx line-numbers-mode" data-ext="jsx"><pre class="language-jsx"><code><span class="token comment">// app</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Child <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./child&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useSetEvent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./useEvent&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">useSetEvent</span><span class="token punctuation">(</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">curr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> curr <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">add +</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Child</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-jsx line-numbers-mode" data-ext="jsx"><pre class="language-jsx"><code><span class="token comment">// child</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useGetEvent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./useEvent&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">Child</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> sub <span class="token operator">=</span> <span class="token function">useGetEvent</span><span class="token punctuation">(</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sub<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>sub<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>äº‹å®ä¸Šä¸æ­¢å­ç»„ä»¶ï¼Œå…¨å±€ç»„ä»¶å¯ä»¥å®ç°</p><p>å¥½äº†ï¼Œä»Šå¤©å°±è¡¨æ¼”åˆ°è¿™äº†ï¼Œæ„Ÿè°¢å¤§å®¶çš„æ§åœº</p><p>è®°å¾—å…³æ³¨æˆ‘å…¬ä¼—å·ï¼šã€ŒèŒèŒå“’è‰å¤´å°†å†›ã€</p>`,6))])}const g=o(u,[["render",k],["__file","ğŸ‘‰è¢«ç©åçš„React hookç»„ä»¶é€šä¿¡ğŸ‘ˆ.html.vue"]]);export{g as default};
