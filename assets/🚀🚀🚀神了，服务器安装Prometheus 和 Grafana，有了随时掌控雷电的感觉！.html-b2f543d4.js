import{_ as t}from"./plugin-vue_export-helper-c27b6911.js";import{r as i,o,c as r,a as e,b as n,e as l,f as d}from"./app-f5aac357.js";const p={},c={href:"https://prometheus.io/download/",target:"_blank",rel:"noopener noreferrer"};function u(m,a){const s=i("ExternalLinkIcon");return o(),r("div",null,[a[5]||(a[5]=e("p",null,"大家好呀，在运行一些服务时，我们可能想看看系统指标的占用情况，所以本文将介绍如何在 CentOS 服务器上安装 Prometheus 和 Grafana，并生成系统 CPU、内存使用率的仪表盘，可以按照以下步骤操作。",-1)),a[6]||(a[6]=e("h3",{id:"一、安装-prometheus",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#一、安装-prometheus","aria-hidden":"true"},"#"),n(" 一、安装 Prometheus")],-1)),a[7]||(a[7]=e("h4",{id:"_1-下载-prometheus",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#_1-下载-prometheus","aria-hidden":"true"},"#"),n(" 1. 下载 Prometheus")],-1)),e("p",null,[a[1]||(a[1]=n("首先，访问 ")),e("a",c,[a[0]||(a[0]=n("Prometheus 官网")),l(s)]),a[2]||(a[2]=n(" 获取最新版本的下载链接，然后使用 ")),a[3]||(a[3]=e("code",null,"wget",-1)),a[4]||(a[4]=n(" 下载："))]),a[8]||(a[8]=d(`<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">wget</span> https://github.com/prometheus/prometheus/releases/download/v2.47.0/prometheus-2.47.0.linux-amd64.tar.gz
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_2-解压并安装" tabindex="-1"><a class="header-anchor" href="#_2-解压并安装" aria-hidden="true">#</a> 2. 解压并安装</h4><p>解压下载的文件：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">tar</span> <span class="token parameter variable">-xvzf</span> prometheus-2.47.0.linux-amd64.tar.gz
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>将解压后的文件夹移动到 <code>/opt/prometheus</code>：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">mv</span> prometheus-2.47.0.linux-amd64 /opt/prometheus
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_3-创建-prometheus-用户" tabindex="-1"><a class="header-anchor" href="#_3-创建-prometheus-用户" aria-hidden="true">#</a> 3. 创建 Prometheus 用户</h4><p>为了安全，创建一个专用用户来运行 Prometheus：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">useradd</span> --no-create-home <span class="token parameter variable">--shell</span> /bin/false prometheus
<span class="token function">sudo</span> <span class="token function">chown</span> <span class="token parameter variable">-R</span> prometheus:prometheus /opt/prometheus
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-配置-prometheus" tabindex="-1"><a class="header-anchor" href="#_4-配置-prometheus" aria-hidden="true">#</a> 4. 配置 Prometheus</h4><p>编辑 Prometheus 配置文件 <code>/opt/prometheus/prometheus.yml</code>：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">nano</span> /opt/prometheus/prometheus.yml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>添加以下内容：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">global</span><span class="token punctuation">:</span>
  <span class="token key atrule">scrape_interval</span><span class="token punctuation">:</span> 15s

<span class="token key atrule">scrape_configs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">job_name</span><span class="token punctuation">:</span> <span class="token string">&quot;node_exporter&quot;</span>
    <span class="token key atrule">static_configs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">targets</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;localhost:9100&quot;</span><span class="token punctuation">]</span>

  <span class="token punctuation">-</span> <span class="token key atrule">job_name</span><span class="token punctuation">:</span> <span class="token string">&quot;prometheus&quot;</span>
    <span class="token key atrule">static_configs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">targets</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;localhost:9090&quot;</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-创建-systemd-服务" tabindex="-1"><a class="header-anchor" href="#_5-创建-systemd-服务" aria-hidden="true">#</a> 5. 创建 Systemd 服务</h4><p>创建 Systemd 服务文件 <code>/etc/systemd/system/prometheus.service</code>：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">nano</span> /etc/systemd/system/prometheus.service
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>添加以下内容：</p><div class="language-ini line-numbers-mode" data-ext="ini"><pre class="language-ini"><code><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Unit</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">Description</span><span class="token punctuation">=</span><span class="token value attr-value">Prometheus</span>
<span class="token key attr-name">Wants</span><span class="token punctuation">=</span><span class="token value attr-value">network-online.target</span>
<span class="token key attr-name">After</span><span class="token punctuation">=</span><span class="token value attr-value">network-online.target</span>

<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Service</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">User</span><span class="token punctuation">=</span><span class="token value attr-value">prometheus</span>
<span class="token key attr-name">Group</span><span class="token punctuation">=</span><span class="token value attr-value">prometheus</span>
<span class="token key attr-name">ExecStart</span><span class="token punctuation">=</span><span class="token value attr-value">/opt/prometheus/prometheus \\</span>
    <span class="token key attr-name">--config.file</span><span class="token punctuation">=</span><span class="token value attr-value">/opt/prometheus/prometheus.yml \\</span>
    <span class="token key attr-name">--storage.tsdb.path</span><span class="token punctuation">=</span><span class="token value attr-value">/opt/prometheus/data</span>
<span class="token key attr-name">Restart</span><span class="token punctuation">=</span><span class="token value attr-value">always</span>

<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Install</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">WantedBy</span><span class="token punctuation">=</span><span class="token value attr-value">multi-user.target</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_6-启动-prometheus" tabindex="-1"><a class="header-anchor" href="#_6-启动-prometheus" aria-hidden="true">#</a> 6. 启动 Prometheus</h4><p>启动并启用 Prometheus 服务：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> systemctl daemon-reload
<span class="token function">sudo</span> systemctl start prometheus
<span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> prometheus
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_7-验证-prometheus" tabindex="-1"><a class="header-anchor" href="#_7-验证-prometheus" aria-hidden="true">#</a> 7. 验证 Prometheus</h4><p>访问 <code>http://&lt;服务器IP&gt;:9090</code>，如果看到 Prometheus 的 Web 界面，说明安装成功。</p><h3 id="二、安装-node-exporter" tabindex="-1"><a class="header-anchor" href="#二、安装-node-exporter" aria-hidden="true">#</a> 二、安装 Node Exporter</h3><p>Node Exporter 用于收集系统指标（如 CPU、内存使用率）。</p><h4 id="_1-下载-node-exporter" tabindex="-1"><a class="header-anchor" href="#_1-下载-node-exporter" aria-hidden="true">#</a> 1. 下载 Node Exporter</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">wget</span> https://github.com/prometheus/node_exporter/releases/download/v1.6.1/node_exporter-1.6.1.linux-amd64.tar.gz
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_2-解压并安装-1" tabindex="-1"><a class="header-anchor" href="#_2-解压并安装-1" aria-hidden="true">#</a> 2. 解压并安装</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">tar</span> <span class="token parameter variable">-xvzf</span> node_exporter-1.6.1.linux-amd64.tar.gz
<span class="token function">sudo</span> <span class="token function">mv</span> node_exporter-1.6.1.linux-amd64/node_exporter /usr/local/bin/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-创建-systemd-服务" tabindex="-1"><a class="header-anchor" href="#_3-创建-systemd-服务" aria-hidden="true">#</a> 3. 创建 Systemd 服务</h4><p>创建 Systemd 服务文件 <code>/etc/systemd/system/node_exporter.service</code>：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">nano</span> /etc/systemd/system/node_exporter.service
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>添加以下内容：</p><div class="language-ini line-numbers-mode" data-ext="ini"><pre class="language-ini"><code><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Unit</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">Description</span><span class="token punctuation">=</span><span class="token value attr-value">Node Exporter</span>
<span class="token key attr-name">Wants</span><span class="token punctuation">=</span><span class="token value attr-value">network-online.target</span>
<span class="token key attr-name">After</span><span class="token punctuation">=</span><span class="token value attr-value">network-online.target</span>

<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Service</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">User</span><span class="token punctuation">=</span><span class="token value attr-value">node_exporter</span>
<span class="token key attr-name">Group</span><span class="token punctuation">=</span><span class="token value attr-value">node_exporter</span>
<span class="token key attr-name">ExecStart</span><span class="token punctuation">=</span><span class="token value attr-value">/usr/local/bin/node_exporter</span>

<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Install</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">WantedBy</span><span class="token punctuation">=</span><span class="token value attr-value">multi-user.target</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-为用户和组增加权限" tabindex="-1"><a class="header-anchor" href="#_4-为用户和组增加权限" aria-hidden="true">#</a> 4. 为用户和组增加权限</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">useradd</span> <span class="token parameter variable">-rs</span> /bin/false node_exporter
<span class="token function">sudo</span> <span class="token function">chown</span> node_exporter:node_exporter /usr/local/bin/node_exporter
<span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token number">755</span> /usr/local/bin/node_exporter
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-启动-node-exporter" tabindex="-1"><a class="header-anchor" href="#_5-启动-node-exporter" aria-hidden="true">#</a> 5. 启动 Node Exporter</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> systemctl daemon-reload
<span class="token function">sudo</span> systemctl start node_exporter
<span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> node_exporter
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_6-验证-node-exporter" tabindex="-1"><a class="header-anchor" href="#_6-验证-node-exporter" aria-hidden="true">#</a> 6. 验证 Node Exporter</h4><p>访问 <code>http://&lt;服务器IP&gt;:9100/metrics</code>，如果看到系统指标数据，说明安装成功。</p><h3 id="三、安装-grafana" tabindex="-1"><a class="header-anchor" href="#三、安装-grafana" aria-hidden="true">#</a> 三、安装 Grafana</h3><h4 id="_1-下载并安装-grafana" tabindex="-1"><a class="header-anchor" href="#_1-下载并安装-grafana" aria-hidden="true">#</a> 1. 下载并安装 Grafana</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> yum <span class="token function">install</span> <span class="token parameter variable">-y</span> https://dl.grafana.com/oss/release/grafana-10.1.1-1.x86_64.rpm
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_2-启动-grafana" tabindex="-1"><a class="header-anchor" href="#_2-启动-grafana" aria-hidden="true">#</a> 2. 启动 Grafana</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> systemctl start grafana-server
<span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> grafana-server
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-访问-grafana" tabindex="-1"><a class="header-anchor" href="#_3-访问-grafana" aria-hidden="true">#</a> 3. 访问 Grafana</h4><p>访问 <code>http://&lt;服务器IP&gt;:3000</code>，使用默认账号 <code>admin</code> 和密码 <code>admin</code> 登录。</p><h3 id="四、配置-grafana-仪表盘" tabindex="-1"><a class="header-anchor" href="#四、配置-grafana-仪表盘" aria-hidden="true">#</a> 四、配置 Grafana 仪表盘</h3><h4 id="_1-添加-prometheus-数据源" tabindex="-1"><a class="header-anchor" href="#_1-添加-prometheus-数据源" aria-hidden="true">#</a> 1. 添加 Prometheus 数据源</h4><ol><li>登录 Grafana，点击左侧菜单的 <strong>Configuration &gt; Data Sources</strong>。</li><li>点击 <strong>Add data source</strong>，选择 <strong>Prometheus</strong>。</li><li>在 URL 中输入 <code>http://localhost:9090</code>，点击 Save &amp; Test。</li></ol><figure><img src="https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/e1d1197f0b4649088ffda36e99fddd1c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JCM6JCM5ZOS6I2J5aS05bCG5Yab:q75.awebp?policy=eyJ2bSI6MywidWlkIjoiMTExNjc1OTU0MzI2MDcyNyJ9&amp;rk3s=f64ab15b&amp;x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&amp;x-orig-expires=1743426352&amp;x-orig-sign=h2AOKJL6SJ7lxlf%2FO7YffyDR2mg%3D" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><figure><img src="https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/1051f61b7c4f4bff81da1ce085baf1c7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JCM6JCM5ZOS6I2J5aS05bCG5Yab:q75.awebp?policy=eyJ2bSI6MywidWlkIjoiMTExNjc1OTU0MzI2MDcyNyJ9&amp;rk3s=f64ab15b&amp;x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&amp;x-orig-expires=1743426352&amp;x-orig-sign=brfR9rFJzHHHOT841w0uoGgZLPM%3D" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h4 id="_2-导入-node-exporter-仪表盘" tabindex="-1"><a class="header-anchor" href="#_2-导入-node-exporter-仪表盘" aria-hidden="true">#</a> 2. 导入 Node Exporter 仪表盘</h4><ol><li>在 <code>dashboad</code>页面点击 <code>Create</code> &gt; <code>Import</code>。</li><li>在 <code>Import via grafana.com</code> 中输入仪表盘 ID <code>1860</code>（Node Exporter 官方仪表盘）。</li><li>选择 Prometheus 数据源，点击 <code>Import</code>。</li></ol><figure><img src="https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/15a24c960a064dd690ab0b792327824f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JCM6JCM5ZOS6I2J5aS05bCG5Yab:q75.awebp?policy=eyJ2bSI6MywidWlkIjoiMTExNjc1OTU0MzI2MDcyNyJ9&amp;rk3s=f64ab15b&amp;x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&amp;x-orig-expires=1743426352&amp;x-orig-sign=UmbtlOqKzx13%2F1arMB5zH43Xh4k%3D" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h4 id="_3-查看仪表盘" tabindex="-1"><a class="header-anchor" href="#_3-查看仪表盘" aria-hidden="true">#</a> 3. 查看仪表盘</h4><p>导入成功后，你可以看到一个完整的系统监控仪表盘，包含 CPU、内存、磁盘、网络等指标。</p><figure><img src="https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/bb3eea6b36ba4b13834b21bdc48e54db~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JCM6JCM5ZOS6I2J5aS05bCG5Yab:q75.awebp?policy=eyJ2bSI6MywidWlkIjoiMTExNjc1OTU0MzI2MDcyNyJ9&amp;rk3s=f64ab15b&amp;x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&amp;x-orig-expires=1743426352&amp;x-orig-sign=xxXtOSIoqch310pMz44y9y3%2FAbc%3D" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="总结" tabindex="-1"><a class="header-anchor" href="#总结" aria-hidden="true">#</a> 总结</h3><p>好了，今天的分享就这些了，如果文章中有任何问题，欢迎指正，真心希望这篇文章帮到你！</p><p>记得关注我！谢谢！</p>`,62))])}const b=t(p,[["render",u],["__file","🚀🚀🚀神了，服务器安装Prometheus 和 Grafana，有了随时掌控雷电的感觉！.html.vue"]]);export{b as default};
