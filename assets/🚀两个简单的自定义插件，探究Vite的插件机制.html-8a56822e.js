import{_ as e}from"./plugin-vue_export-helper-c27b6911.js";import{r as o,o as i,c,a as s,b as a,e as t,f as l}from"./app-1a848f08.js";const u={},r={href:"https://juejin.cn/post/7243975432088830009#heading-1",target:"_blank",rel:"noopener noreferrer"},k={href:"https://cn.vitejs.dev/guide/api-plugin.html#universal-hooks",target:"_blank",rel:"noopener noreferrer"},d={href:"https://cn.vitejs.dev/guide/api-plugin.html#vite-specific-hooks",target:"_blank",rel:"noopener noreferrer"};function v(m,n){const p=o("ExternalLinkIcon");return i(),c("div",null,[n[5]||(n[5]=s("blockquote",null,[s("p",null,"æ–‡ç« é¦–å‘å…¬ä¼—å·ï¼šèŒèŒå“’è‰å¤´å°†å†›ï¼Œæœ€è¿‘ç¾¤é‡Œæœ‰æŠ½å¥–ï¼Œé€å‡ºäº”æœ¬ä¹¦ï¼Œç¾¤é‡Œç›®å‰å·²ç»å¿«20ä½å°ä¼™ä¼´äº†ï¼Œæ¦‚ç‡å¾ˆå¤§ï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´å…³æ³¨åè”ç³»æˆ‘å³å¯å…¥ç¾¤ã€‚ä¸ªäººè”ç³»æ–¹å¼ï¼šSunBoy_mmdctjj")],-1)),n[6]||(n[6]=s("p",{align:"center"},[s("img",{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/379970510dc440e59ce70a298c2a3286~tplv-k3u1fbpfcp-watermark.image?",alt:"grif.gif",width:"50%"})],-1)),s("p",null,[s("a",r,[n[0]||(n[0]=a("é˜…è¯»æ›´å¤šæ–‡ç« ç‚¹è¿™é‡Œ")),t(p)])]),n[7]||(n[7]=s("h2",{id:"ğŸš€-vite-æ’ä»¶æœºåˆ¶",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#ğŸš€-vite-æ’ä»¶æœºåˆ¶","aria-hidden":"true"},"#"),a(" ğŸš€ Vite æ’ä»¶æœºåˆ¶")],-1)),n[8]||(n[8]=s("p",null,"Vite çš„æ’ä»¶æœºåˆ¶æ˜¯åŸºäº Rollup çš„æ’ä»¶æœºåˆ¶å®ç°çš„ï¼Œä½†æ˜¯åˆè¿›è¡Œäº†ä¸€äº›æ‰©å±•ã€‚Vite çš„æ’ä»¶æœºåˆ¶æ˜¯é€šè¿‡é’©å­å‡½æ•°å®ç°çš„ï¼Œå½“ Vite è¿è¡Œæ—¶ï¼Œä¼šé€šè¿‡é’©å­å‡½æ•°è°ƒç”¨æ’ä»¶ä¸­çš„æ–¹æ³•ï¼Œæ’ä»¶å¯ä»¥åœ¨è¿™äº›æ–¹æ³•ä¸­å¹²é¢„ Vite çš„æ„å»ºè¿‡ç¨‹ã€‚",-1)),n[9]||(n[9]=s("p",null,"æˆ‘ä»¬ä¸»è¦è®¨è®ºæ’ä»¶çš„æœºåˆ¶ï¼ŒAPI è¯¦ç»†è¯·çœ‹å®˜ç½‘ä»‹ç»",-1)),s("p",null,[n[2]||(n[2]=a("é€šç”¨çš„é’©å­ï¼š")),s("a",k,[n[1]||(n[1]=a("https://cn.vitejs.dev/guide/api-plugin.html#universal-hooks")),t(p)])]),s("p",null,[n[4]||(n[4]=a("Vite ç‹¬æœ‰çš„é’©å­ï¼š")),s("a",d,[n[3]||(n[3]=a("https://cn.vitejs.dev/guide/api-plugin.html#vite-specific-hooks")),t(p)])]),n[10]||(n[10]=l(`<p>ä¸‹é¢æˆ‘ä»¬çœ‹çœ‹æ’ä»¶çš„æœºåˆ¶åŸç†ã€‚</p><h3 id="ğŸš—-rollup-æ’ä»¶æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#ğŸš—-rollup-æ’ä»¶æœºåˆ¶" aria-hidden="true">#</a> ğŸš— Rollup æ’ä»¶æœºåˆ¶</h3><p>Rollup çš„æ’ä»¶æœºåˆ¶å®ç°ä¸»è¦åŸºäºä¸¤ç‚¹:</p><ul><li>Rollup ç»´æŠ¤äº†å„ä¸ªæ’ä»¶æ¥å£çš„ Hook åˆ—è¡¨,æ’ä»¶å¯ä»¥å‘è¿™äº›åˆ—è¡¨ä¸­æ·»åŠ å›è°ƒå‡½æ•°ã€‚</li><li>åœ¨æ‰§è¡Œå¯¹åº”è¿‡ç¨‹æ—¶,Rollup ä¼šä¾æ¬¡è§¦å‘è¿™äº› Hook åˆ—è¡¨ä¸­çš„å›è°ƒå‡½æ•°ã€‚</li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> hookLists <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">load</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// load hook åˆ—è¡¨</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">addHook</span><span class="token punctuation">(</span><span class="token parameter">hookName<span class="token punctuation">,</span> hook</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  hookLists<span class="token punctuation">[</span>hookName<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>hook<span class="token punctuation">)</span>  <span class="token comment">// å‘ hook åˆ—è¡¨ä¸­æ·»åŠ å›è°ƒå‡½æ•°</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> hook <span class="token keyword">of</span> hookLists<span class="token punctuation">.</span>load<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// è§¦å‘æ‰€æœ‰ load é’©å­å‡½æ•°</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">hook</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>  <span class="token comment">// è°ƒç”¨é’©å­å‡½æ•°</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token keyword">return</span> result  <span class="token comment">// ä½¿ç”¨ç¬¬ä¸€ä¸ªç»“æœå¹¶è¿”å›</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ’ä»¶å¯ä»¥é€šè¿‡ Rollup æä¾›çš„ addHook æ–¹æ³•ç›¸å¯¹åº”çš„ Hook åˆ—è¡¨ä¸­æ·»åŠ å›è°ƒå‡½æ•°:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">myPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">addHook</span><span class="token punctuation">(</span><span class="token string">&#39;load&#39;</span><span class="token punctuation">,</span> <span class="token parameter">id</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token comment">// å‘ load åˆ—è¡¨æ·»åŠ å›è°ƒå‡½æ•°</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ğŸš—-vite-çš„å·§å¦™ä¹‹å¤„" tabindex="-1"><a class="header-anchor" href="#ğŸš—-vite-çš„å·§å¦™ä¹‹å¤„" aria-hidden="true">#</a> ğŸš— Vite çš„å·§å¦™ä¹‹å¤„</h3><p>Vite ä¸»è¦å°†ç”¨æˆ·æ’ä»¶æ’åºï¼Œç„¶åå’Œå†…ç½®çš„æ’ä»¶é…ç½®åˆå¹¶ï¼Œä¼ é€’ç»™äº† Rollup æ‰“åŒ…ã€‚</p><p>å…³é”®çš„éƒ¨åˆ†æºç å¦‚ä¸‹ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// vite/node/config.ts</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">resolveConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  
  <span class="token comment">// ...</span>
  
  <span class="token comment">// resolve plugins</span>
  <span class="token keyword">const</span> rawUserPlugins <span class="token operator">=</span> <span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token function">asyncFlatten</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>plugins <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> Plugin<span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>filterPlugin<span class="token punctuation">)</span>

  <span class="token keyword">const</span> <span class="token punctuation">[</span>prePlugins<span class="token punctuation">,</span> normalPlugins<span class="token punctuation">,</span> postPlugins<span class="token punctuation">]</span> <span class="token operator">=</span>
    <span class="token function">sortUserPlugins</span><span class="token punctuation">(</span>rawUserPlugins<span class="token punctuation">)</span>
  
  <span class="token comment">// run config hooks</span>
  <span class="token keyword">const</span> userPlugins <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>prePlugins<span class="token punctuation">,</span> <span class="token operator">...</span>normalPlugins<span class="token punctuation">,</span> <span class="token operator">...</span>postPlugins<span class="token punctuation">]</span>
  
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// vite/node/build.ts </span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">resolveConfig</span><span class="token punctuation">(</span>
    inlineConfig<span class="token punctuation">,</span>
    <span class="token string">&#39;build&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;production&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;production&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span>
  
  <span class="token comment">//...</span>
  
  <span class="token keyword">const</span> plugins <span class="token operator">=</span> <span class="token punctuation">(</span>
    ssr <span class="token operator">?</span> config<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">p</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">injectSsrFlagToHooks</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">:</span> config<span class="token punctuation">.</span>plugins
  <span class="token punctuation">)</span> <span class="token keyword">as</span> Plugin<span class="token punctuation">[</span><span class="token punctuation">]</span>
  
  <span class="token keyword">const</span> <span class="token literal-property property">rollupOptions</span><span class="token operator">:</span> RollupOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">context</span><span class="token operator">:</span> <span class="token string">&#39;globalThis&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">preserveEntrySignatures</span><span class="token operator">:</span> ssr
      <span class="token operator">?</span> <span class="token string">&#39;allow-extension&#39;</span>
      <span class="token operator">:</span> libOptions
      <span class="token operator">?</span> <span class="token string">&#39;strict&#39;</span>
      <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token literal-property property">cache</span><span class="token operator">:</span> config<span class="token punctuation">.</span>build<span class="token punctuation">.</span>watch <span class="token operator">?</span> <span class="token keyword">undefined</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>options<span class="token punctuation">.</span>rollupOptions<span class="token punctuation">,</span>
    input<span class="token punctuation">,</span>
    plugins<span class="token punctuation">,</span>
    external<span class="token punctuation">,</span>
    <span class="token function">onwarn</span><span class="token punctuation">(</span><span class="token parameter">warning<span class="token punctuation">,</span> warn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">onRollupWarning</span><span class="token punctuation">(</span>warning<span class="token punctuation">,</span> warn<span class="token punctuation">,</span> config<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// ...</span>

  <span class="token comment">// write or generate files with rollup</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> rollup <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&#39;rollup&#39;</span><span class="token punctuation">)</span>
  bundle <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">rollup</span><span class="token punctuation">(</span>rollupOptions<span class="token punctuation">)</span>
  
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Vite ä½¿ç”¨æ’ä»¶æ—¶ï¼Œéœ€è¦å°†æ’ä»¶æ”¾å…¥ plugins çš„æ•°ç»„ä¸­å¦‚ä¸‹ï¼š</p><figure><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7afd5d51db8741d98763651b168430d8~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><h2 id="ğŸš€-å®è·µå¾—çœŸçŸ¥" tabindex="-1"><a class="header-anchor" href="#ğŸš€-å®è·µå¾—çœŸçŸ¥" aria-hidden="true">#</a> ğŸš€ å®è·µå¾—çœŸçŸ¥</h2><p>æ¥ä¸‹æ¥æˆ‘ä»¬è‡ªå®šä¹‰å‡ ä¸ªæ’ä»¶ï¼Œæ„Ÿå—ä¸‹ Vite çš„æ’ä»¶æœºåˆ¶ã€‚</p><blockquote><p>å†™è¿™å‡ ä¸ªæ’ä»¶æ˜¯ä¸ºäº†ç†è§£æ’ä»¶æœºåˆ¶ï¼Œå®˜æ–¹å·²ç»æä¾›äº†ç›¸å…³çš„é…ç½®æˆ–è€…ç°æˆçš„æ’ä»¶</p></blockquote><h3 id="ğŸš—-è‡ªåŠ¨åˆ‡æ¢ç«¯å£-é»˜è®¤8080" tabindex="-1"><a class="header-anchor" href="#ğŸš—-è‡ªåŠ¨åˆ‡æ¢ç«¯å£-é»˜è®¤8080" aria-hidden="true">#</a> ğŸš— è‡ªåŠ¨åˆ‡æ¢ç«¯å£ï¼Œé»˜è®¤<code>8080</code></h3><p>Vite é»˜è®¤çš„ç«¯å£ä¸æ˜¯ <code>8080</code>äº†ï¼Œæœ‰ç‚¹ä¸å¤ªä¹ æƒ¯ï¼Œæ‰€ä»¥è‡ªå·±å†™ä¸ªæ’ä»¶è‡ªåŠ¨åˆ‡æ¢ç«¯å£ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> net <span class="token keyword">from</span> <span class="token string">&#39;net&#39;</span>

<span class="token keyword">function</span> <span class="token function">getNextPort</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">port</span><span class="token operator">:</span> number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> server <span class="token operator">=</span> net<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    server<span class="token punctuation">.</span><span class="token function">unref</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token function">getNextPort</span><span class="token punctuation">(</span>port <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      server<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">autoSwitchPortPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> port <span class="token operator">=</span> <span class="token number">8080</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;auto-switch-port&#39;</span><span class="token punctuation">,</span>
    <span class="token keyword">async</span> <span class="token function">configResolved</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">config</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      port <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getNextPort</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span> <span class="token keyword">as</span> number
      config<span class="token punctuation">.</span>server<span class="token punctuation">.</span>port <span class="token operator">=</span> port
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> autoSwitchPortPlugin
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/51b36f52134b402c82d75e3777bf41e2~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><h3 id="ğŸš—-ä¸ºæ–‡ä»¶åŠ ä¸Šç‰ˆæœ¬å·" tabindex="-1"><a class="header-anchor" href="#ğŸš—-ä¸ºæ–‡ä»¶åŠ ä¸Šç‰ˆæœ¬å·" aria-hidden="true">#</a> ğŸš— ä¸ºæ–‡ä»¶åŠ ä¸Šç‰ˆæœ¬å·</h3><p>ç”±äºè¿™ä¸ªæ“ä½œæ˜¯è½¬æ¢Â <code>index.html</code>æ–‡ä»¶ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ä¸“ç”¨é’©å­<code>transformIndexHtml</code></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createHash <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;crypto&quot;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">autoVersionPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;auto-version&#39;</span><span class="token punctuation">,</span>
    <span class="token keyword">async</span> <span class="token function">transformIndexHtml</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">html</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> hash <span class="token operator">=</span> <span class="token function">createHash</span><span class="token punctuation">(</span><span class="token string">&#39;md5&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span><span class="token string">&#39;hex&#39;</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> html<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(src|href)=&quot;(.*?)&quot;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">$1=&quot;$2?v=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>hash<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/507505625f44426da3e6af23a2ea650c~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><h2 id="ğŸ‰-æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#ğŸ‰-æ€»ç»“" aria-hidden="true">#</a> ğŸ‰ æ€»ç»“</h2><p>Vite æ’ä»¶æœºåˆ¶ä¸»è¦åœ¨æ•´ä¸ªæ„å»ºè¿‡ç¨‹çš„ä¸åŒæ—¶æœºæš´éœ²å‡ºé’©å­å‡½æ•°ä¾›å¼€å‘è€…çµæ´»è‡ªå®šä¹‰æ„å»ºè¿‡ç¨‹ã€‚æ‰€ä»¥ç†è§£æ„å»ºæµç¨‹ï¼Œæ‰èƒ½æ›´å¥½çš„å¼€å‘ä¸€ä¸ªä¼˜ç§€çš„æ’ä»¶ã€‚</p><p>å¥½äº†ä»Šå¤©çš„åˆ†äº«å°±åˆ°è¿™äº†ï¼Œå¦‚æœæ–‡ä¸­æœ‰çº°æ¼çš„åœ°æ–¹ï¼Œæ¬¢è¿æŒ‡æ­£ï¼ï¼ï¼</p>`,28))])}const f=e(u,[["render",v],["__file","ğŸš€ä¸¤ä¸ªç®€å•çš„è‡ªå®šä¹‰æ’ä»¶ï¼Œæ¢ç©¶Viteçš„æ’ä»¶æœºåˆ¶.html.vue"]]);export{f as default};
